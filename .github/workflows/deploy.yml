name: Deploy to Vercel

on:
  workflow_call:
    inputs:
      vercel_env:
        description: 'Vercel environment'
        required: true
        type: string
      vercel_org_id:
        description: 'Vercel Org ID'
        required: true
        type: string
      vercel_project_id:
        description: 'Vercel Project ID'
        required: true
        type: string
      firebase_api_key:
        description: 'Firebase API Key'
        required: true
        type: string
      firebase_auth_domain:
        description: 'Firebase Auth Domain'
        required: true
        type: string
      firebase_project_id:
        description: 'Firebase Project ID'
        required: true
        type: string
      firebase_storage_bucket:
        description: 'Firebase Storage Bucket'
        required: true
        type: string
      firebase_messaging_sender_id:
        description: 'Firebase Messaging Sender ID'
        required: true
        type: string
      firebase_app_id:
        description: 'Firebase App ID'
        required: true
        type: string

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      # Passo para definir vari√°veis de ambiente no Vercel
      - name: Set Env Vars on Vercel Project
        uses: dkershner6/vercel-set-env-action@v1
        with:
          token: ${{ secrets.VERCEL_TOKEN }}
          projectName: inorbit-fernandes
          envVariableKeys: FIREBASE_API_KEY,FIREBASE_AUTH_DOMAIN,FIREBASE_PROJECT_ID,FIREBASE_STORAGE_BUCKET,FIREBASE_MESSAGING_SENDER_ID,FIREBASE_APP_ID
        env:
          FIREBASE_API_KEY: ${{ inputs.firebase_api_key }}
          FIREBASE_AUTH_DOMAIN: ${{ inputs.firebase_auth_domain }}
          FIREBASE_PROJECT_ID: ${{ inputs.firebase_project_id }}
          FIREBASE_STORAGE_BUCKET: ${{ inputs.firebase_storage_bucket }}
          FIREBASE_MESSAGING_SENDER_ID: ${{ inputs.firebase_messaging_sender_id }}
          FIREBASE_APP_ID: ${{ inputs.firebase_app_id }}

      # Deploy no Vercel
      - name: Deploy site to Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-args: '--prod'
          vercel-org-id: ${{ inputs.vercel_org_id }}
          vercel-project-id: ${{ inputs.vercel_project_id }}