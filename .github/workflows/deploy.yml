name: Deploy to Vercel

on:
  pull_request:
    branches:
      - develop  # para ambiente de desenvolvimento
      - uat      # para ambiente de UAT
      - main     # para ambiente de produção

jobs:
  deploy_develop:
    if: github.ref == 'refs/heads/develop'  # Este job só roda para a branch develop
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set Env Vars on Vercel Project
        uses: dkershner6/vercel-set-env-action@v1
        with:
          token: ${{ secrets.VERCEL_TOKEN }}
          projectName: inorbit-web
          envVariableKeys: FIREBASE_API_KEY,FIREBASE_AUTH_DOMAIN,FIREBASE_PROJECT_ID,FIREBASE_STORAGE_BUCKET,FIREBASE_MESSAGING_SENDER_ID,FIREBASE_APP_ID
        env:
          FIREBASE_API_KEY: ${{ secrets.FIREBASE_API_KEY }}
          TARGET_FIREBASE_API_KEY: development
          TYPE_FIREBASE_API_KEY: encrypted
          FIREBASE_AUTH_DOMAIN: ${{ secrets.FIREBASE_AUTH_DOMAIN }}
          TARGET_FIREBASE_AUTH_DOMAIN: development
          TYPE_FIREBASE_AUTH_DOMAIN: encrypted
          FIREBASE_PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}
          TARGET_FIREBASE_PROJECT_ID: development
          TYPE_FIREBASE_PROJECT_ID: encrypted
          FIREBASE_STORAGE_BUCKET: ${{ secrets.FIREBASE_STORAGE_BUCKET }}
          TARGET_FIREBASE_STORAGE_BUCKET: development
          TYPE_FIREBASE_STORAGE_BUCKET: encrypted
          FIREBASE_MESSAGING_SENDER_ID: ${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}
          TARGET_FIREBASE_MESSAGING_SENDER_ID: development
          TYPE_FIREBASE_MESSAGING_SENDER_ID: encrypted
          FIREBASE_APP_ID: ${{ secrets.FIREBASE_APP_ID }}
          TARGET_FIREBASE_APP_ID: development
          TYPE_FIREBASE_APP_ID: encrypted
      - name: deploy site to vercel (develop)
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-args: '--development'
          vercel-org-id: ${{ secrets.DEVELOP_ORG_ID }}
          vercel-project-id: ${{ secrets.DEVELOP_PROJECT_ID }}

  deploy_uat:
    if: github.base_ref == 'uat'  # Verifica se a branch base do PR é 'uat'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set Env Vars on Vercel Project
        uses: dkershner6/vercel-set-env-action@v1
        with:
          token: ${{ secrets.VERCEL_TOKEN }}
          projectName: inorbit-web
          envVariableKeys: FIREBASE_API_KEY,FIREBASE_AUTH_DOMAIN,FIREBASE_PROJECT_ID,FIREBASE_STORAGE_BUCKET,FIREBASE_MESSAGING_SENDER_ID,FIREBASE_APP_ID
        env:
          FIREBASE_API_KEY: ${{ secrets.FIREBASE_API_KEY }}
          TARGET_FIREBASE_API_KEY: preview
          TYPE_FIREBASE_API_KEY: encrypted
          FIREBASE_AUTH_DOMAIN: ${{ secrets.FIREBASE_AUTH_DOMAIN }}
          TARGET_FIREBASE_AUTH_DOMAIN: preview
          TYPE_FIREBASE_AUTH_DOMAIN: encrypted
          FIREBASE_PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}
          TARGET_FIREBASE_PROJECT_ID: preview
          TYPE_FIREBASE_PROJECT_ID: encrypted
          FIREBASE_STORAGE_BUCKET: ${{ secrets.FIREBASE_STORAGE_BUCKET }}
          TARGET_FIREBASE_STORAGE_BUCKET: preview
          TYPE_FIREBASE_STORAGE_BUCKET: encrypted
          FIREBASE_MESSAGING_SENDER_ID: ${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}
          TARGET_FIREBASE_MESSAGING_SENDER_ID: preview
          TYPE_FIREBASE_MESSAGING_SENDER_ID: encrypted
          FIREBASE_APP_ID: ${{ secrets.FIREBASE_APP_ID }}
          TARGET_FIREBASE_APP_ID: preview
          TYPE_FIREBASE_APP_ID: encrypted
      - name: deploy site to vercel (UAT)
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-args: '--uat'
          vercel-org-id: ${{ secrets.UAT_ORG_ID }}
          vercel-project-id: ${{ secrets.UAT_PROJECT_ID }}

  deploy_production:
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set Env Vars on Vercel Project
        uses: dkershner6/vercel-set-env-action@v1
        with:
          token: ${{ secrets.VERCEL_TOKEN }}
          projectName: inorbit-web
          envVariableKeys: FIREBASE_API_KEY,FIREBASE_AUTH_DOMAIN,FIREBASE_PROJECT_ID,FIREBASE_STORAGE_BUCKET,FIREBASE_MESSAGING_SENDER_ID,FIREBASE_APP_ID
        env:
          FIREBASE_API_KEY: ${{ secrets.FIREBASE_API_KEY }}
          TARGET_FIREBASE_API_KEY: production
          TYPE_FIREBASE_API_KEY: encrypted
          FIREBASE_AUTH_DOMAIN: ${{ secrets.FIREBASE_AUTH_DOMAIN }}
          TARGET_FIREBASE_AUTH_DOMAIN: production
          TYPE_FIREBASE_AUTH_DOMAIN: encrypted
          FIREBASE_PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}
          TARGET_FIREBASE_PROJECT_ID: production
          TYPE_FIREBASE_PROJECT_ID: encrypted
          FIREBASE_STORAGE_BUCKET: ${{ secrets.FIREBASE_STORAGE_BUCKET }}
          TARGET_FIREBASE_STORAGE_BUCKET: production
          TYPE_FIREBASE_STORAGE_BUCKET: encrypted
          FIREBASE_MESSAGING_SENDER_ID: ${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}
          TARGET_FIREBASE_MESSAGING_SENDER_ID: production
          TYPE_FIREBASE_MESSAGING_SENDER_ID: encrypted
          FIREBASE_APP_ID: ${{ secrets.FIREBASE_APP_ID }}
          TARGET_FIREBASE_APP_ID: production
          TYPE_FIREBASE_APP_ID: encrypted
      - name: deploy site to vercel (production)
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-args: '--prod'
          vercel-org-id: ${{ secrets.PRODUCTION_ORG_ID }}
          vercel-project-id: ${{ secrets.PRODUCTION_PROJECT_ID }}
